# âœ… 2. ì´ë²¤íŠ¸ ë£¨í”„ (Event Loop)
## 2.1 ì´ë²¤íŠ¸ ë£¨í”„ ë™ì‘ ì›ë¦¬
ğŸ”¹ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ìŠ¤ë ˆë“œë‹¤
- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ì‹±ê¸€ ìŠ¤ë ˆë“œ(Single Thread)**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

- í•œ ë²ˆì— í•œ ì‘ì—…ë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆì§€ë§Œ, **Web APIs (ë¸Œë¼ìš°ì € or Node.jsì˜ ë°±ê·¸ë¼ìš´ë“œ)**ì™€ ì´ë²¤íŠ¸ ë£¨í”„ ë•ë¶„ì— ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ğŸ”¹ Call Stack, Web APIs, Callback Queue, Microtask Queue ê°œë…
- Call Stack: í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ í•¨ìˆ˜ë“¤ì˜ í˜¸ì¶œ ìˆœì„œê°€ ìŒ“ì´ëŠ” ìŠ¤íƒ.

- Web APIs: íƒ€ì´ë¨¸(setTimeout ë“±), Ajax, DOM ì´ë²¤íŠ¸ ë“±ì„ ì‹¤í–‰í•˜ê³  ì½œë°±ì„ ë‚˜ì¤‘ì— Queueì— ë„£ìŒ.

- Callback Queue (Macrotask Queue): ì¼ë°˜ ì½œë°± (setTimeout, setInterval ë“±)ì˜ ëŒ€ê¸°ì—´.

- Microtask Queue: Promise.then, queueMicrotask, MutationObserver ë“± ê³ ìš°ì„ ìˆœìœ„ ì‘ì—… ëŒ€ê¸°ì—´.

ğŸ”¹ Task vs Microtask ì°¨ì´
êµ¬ë¶„	Macrotask (Task)	Microtask
ì˜ˆì‹œ	setTimeout, setInterval, I/O	Promise.then, async/await, queueMicrotask
ì‹¤í–‰ íƒ€ì´ë°	ê° macrotask ì‚¬ì´	macrotask ì§í›„, render ì´ì „
ìš°ì„ ìˆœìœ„	ë‚®ìŒ	ë†’ìŒ

ğŸ“Œ ê°„ë‹¨ ì˜ˆì‹œ:

```js
console.log('1');

setTimeout(() => console.log('setTimeout'), 0);

Promise.resolve().then(() => console.log('promise'));

console.log('2');
/*
ğŸ“‹ ì‹¤í–‰ ìˆœì„œ:
1
2
promise
setTimeout
*/
```
## 2.2 ì´ë²¤íŠ¸ ë£¨í”„ì˜ ìˆœí™˜ êµ¬ì¡°
ğŸ”¹ Macrotask â†’ Microtask â†’ Render ìˆœì„œ
1.  Call Stackì´ ë¹„ì–´ ìˆìœ¼ë©´ ì´ë²¤íŠ¸ ë£¨í”„ê°€ macrotaskë¥¼ í•˜ë‚˜ ì²˜ë¦¬
1.  ì´ì–´ì„œ ëª¨ë“  microtaskë¥¼ ì‹¤í–‰
1. ê·¸ ë‹¤ìŒ ë¸Œë¼ìš°ì €ê°€ í™”ë©´ì„ rendering

ğŸ”¹ ì£¼ìš” ë¹„ë™ê¸° APIë“¤ì˜ ì²˜ë¦¬ ìœ„ì¹˜ (ì •ë¦¬)
|API|	Queue| ì¢…ë¥˜	ì„¤ëª…|
|-|-|-|
|setTimeout|	Macrotask|	ìµœì†Œ ì§€ì—° í›„ ì½œë°± ë“±ë¡|
|setInterval|	Macrotask|	ì¼ì • ê°„ê²© ë°˜ë³µ|
|Promise.then|	Microtask|	ì¦‰ì‹œ ì‹¤í–‰ ì˜ˆì•½ (Call Stack ëë‚˜ë©´)|
|async/await|	Microtask|	ë‚´ë¶€ì ìœ¼ë¡œ `Promise` ì‚¬ìš©|
|queueMicrotask|	Microtask|	Promiseì™€ ë™ì¼|
|MutationObserver|	Microtask|	DOM ë³€ê²½ ê°ì§€ ì‹œ ì‹¤í–‰|

ğŸ“Œ ì˜ˆì‹œ:

```js
setTimeout(() => console.log('timeout'), 0);
queueMicrotask(() => console.log('microtask'));
console.log('sync');
/*
ğŸ“‹ ì‹¤í–‰ ìˆœì„œ:
sync
microtask
timeout
*/
```

## 2.3 ë¸Œë¼ìš°ì €ì™€ Node.jsì˜ ì°¨ì´
ğŸ”¹ ë¸Œë¼ìš°ì €ì˜ ì´ë²¤íŠ¸ ë£¨í”„ êµ¬ì¡°
ë¸Œë¼ìš°ì €ëŠ” HTML íŒŒì‹±, ë Œë”ë§, ì´ë²¤íŠ¸ ì²˜ë¦¬ ë“±ì„ í¬í•¨í•˜ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì‹¤í–‰

Microtask â†’ Render â†’ Macrotask ì‚¬ì´í´ êµ¬ì¡°

ğŸ”¹ Node.jsì˜ libuv ê¸°ë°˜ Event Loop êµ¬ì¡°
Node.jsëŠ” C ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ libuvë¥¼ í†µí•´ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ êµ¬í˜„í•˜ë©° ë‹¤ìŒê³¼ ê°™ì€ **6ë‹¨ê³„(Phase)**ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. timers: setTimeout, setInterval ì½œë°± ì‹¤í–‰
1. pending callbacks: ì¼ë¶€ I/O ì½œë°± ì²˜ë¦¬
1. idle, prepare: ë‚´ë¶€ ìš©ë„
1. poll: I/O ì´ë²¤íŠ¸ ëŒ€ê¸° ë° ì²˜ë¦¬
1. check: setImmediate ì‹¤í–‰
1. close callbacks: ì†Œì¼“ ì¢…ë£Œ ë“± ì²˜ë¦¬
> ê° phaseê°€ ëë‚œ í›„ **microtask queue(Promise ë“±)**ê°€ í•­ìƒ ìš°ì„  ì‹¤í–‰ë©ë‹ˆë‹¤.

## 2.4 ì‹¤ì „ ì˜ˆì œ ë° ë©´ì ‘ ì§ˆë¬¸
ğŸ”¹ Promise + setTimeout + async/await í˜¼í•© ì‹¤í–‰ ìˆœì„œ ì˜ˆì¸¡
ğŸ“Œ ì˜ˆì‹œ:

```js
async function asyncFunc() {
  console.log('async1');
  await Promise.resolve();
  console.log('async2');
}

console.log('script start');

setTimeout(() => console.log('setTimeout'), 0);

asyncFunc();

Promise.resolve().then(() => console.log('promise'));

console.log('script end');
/*
ğŸ“‹ ì˜ˆìƒ ì¶œë ¥:

script start
async1
script end
promise        // microtask
async2         // microtask
setTimeout     // macrotask
*/
```
ğŸ”¹ render-blocking task ë¶„ì„
ğŸ“Œ ì˜ˆ:
```js
while (Date.now() < performance.now() + 1000) {}
console.log('done');
```
- ë Œë”ë§ê³¼ ì´ë²¤íŠ¸ ì²˜ë¦¬ ëª¨ë‘ ë¸”ë¡œí‚¹ë¨
- UIê°€ 1ì´ˆ ë™ì•ˆ ë©ˆì¶˜ ê²ƒì²˜ëŸ¼ ë³´ì„
- í•´ê²°: requestIdleCallback, setTimeout, Web Worker ë“±ìœ¼ë¡œ ì‘ì—… ë¶„ë¦¬

ğŸ’¬ ë©´ì ‘ ì§ˆë¬¸ ì˜ˆì‹œ ë° í¬ì¸íŠ¸
1. Q: setTimeout(fn, 0)ì´ ë°”ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”?
- A: ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œì´ë¯€ë¡œ, setTimeoutì€ ìµœì†Œ ì§€ì—° ì‹œê°„ì„ ë³´ì¥í•  ë¿ ì½œìŠ¤íƒì´ ë¹„ì›Œì§„ í›„ì—ì•¼ ì‹¤í–‰ë©ë‹ˆë‹¤.
2. Q: Promiseì˜ thenê³¼ setTimeoutì˜ ì‹¤í–‰ ìˆœì„œëŠ”?
- A: Promise.thenì€ microtask, setTimeoutì€ macrotaskì´ë¯€ë¡œ, thenì´ ë¨¼ì € ì‹¤í–‰ë©ë‹ˆë‹¤.
3. Q: Node.jsì˜ ì´ë²¤íŠ¸ ë£¨í”„ ë‹¨ê³„ ì¤‘ poll phaseë€?
- A: poll phaseëŠ” I/O ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ê³  ì²˜ë¦¬í•˜ëŠ” ë‹¨ê³„ì´ë©°, ì½œë°±ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ë‹¤ìŒ phaseë¡œ ë„˜ì–´ê°ˆ íƒ€ì´ë°ì„ ê²°ì •í•©ë‹ˆë‹¤.
4. Q: async/await ê°€ ì´ë²¤íŠ¸ ë£¨í”„, ì½œìŠ¤íƒ ë“±ì—ì„œ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?
- A: awaitëŠ” Promiseë¥¼ ë§Œë‚˜ë©´ í˜„ì¬ í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³ , ì½œë°±ì„ microtask queueì— ë“±ë¡í•œ ë’¤ ë‚˜ë¨¸ì§€ ì½”ë“œë¥¼ ë‚˜ì¤‘ì— ì‹¤í–‰í•©ë‹ˆë‹¤.

ğŸ“Œ ì˜ˆì‹œ:

```js
async function test() {
  console.log('start');
  await null;
  console.log('end');
}
test();
// ì¶œë ¥: start â†’ end (endëŠ” ë‹¤ìŒ tickì˜ microtaskë¡œ ì‹¤í–‰)
```